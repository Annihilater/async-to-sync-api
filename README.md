# 异步到同步API转换

这个项目演示了如何将异步API接口封装为同步调用方式，实现了以下功能：

1. `AsyncAPI` - 模拟异步API接口，使用回调方式返回结果
2. `SPI` - 模拟回调接口，用于接收异步请求的响应
3. `SyncAPIWrapper` - 同步封装类，使用队列和事件循环将异步API转换为同步调用方式

## 实现原理

同步封装的核心原理：

1. 在独立线程中运行事件循环
2. 使用队列存储异步回调的结果
3. 阻塞等待队列中的结果，实现同步调用
4. 超时机制确保不会无限等待

## 运行方式

```bash
python main.py
```

## 示例输出

```
开始同步调用...
异步请求开始: req-001, 数据: {'value': '测试1'}
收到回调响应: {'request_id': 'req-001', 'result': '处理结果-测试1', 'timestamp': 1629123456.789}
同步调用结果1: {'request_id': 'req-001', 'result': '处理结果-测试1', 'timestamp': 1629123456.789}
异步请求开始: req-002, 数据: {'value': '测试2'}
收到回调响应: {'request_id': 'req-002', 'result': '处理结果-测试2', 'timestamp': 1629123458.123}
同步调用结果2: {'request_id': 'req-002', 'result': '处理结果-测试2', 'timestamp': 1629123458.123}
```

## 技术要点

- 使用`asyncio`处理异步操作
- 使用`threading`和`queue`实现线程间通信
- 使用`run_coroutine_threadsafe`在独立线程中运行协程
- 资源清理和异常处理机制 